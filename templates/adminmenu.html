<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin Dashboard ‚Äî Online Canteen</title>
  <link rel="stylesheet" href="/static/style.css">
  <link rel="stylesheet" href="/static/adminmenu.css">
</head>
<body>
  <header class="topbar">
    <div class="brand">üßæ Admin Dashboard</div>
    <nav class="nav">
      <a href="#" onclick="logoutUser()">Logout</a>
    </nav>
  </header>

  <main class="container">
    <div class="tab-buttons">
      <button id="tabOrders" class="active" onclick="switchTab('orders')">üì¶ Orders</button>
      <button id="tabMenu" onclick="switchTab('menu')">üçΩÔ∏è Menu (Sold Out / Available)</button>
    </div>

    <!-- Orders Dashboard -->
    <section id="ordersSection" class="tab-content active">
      <h2>Pending / Completed Orders</h2>
      <div id="ordersList" class="orders-list"></div>
    </section>

    <!-- Menu Dashboard -->
    <section id="menuSection" class="tab-content">
      <h2>Menu Management</h2>
      <p>Add, edit, or remove menu items. Control what items are available for customers.</p>
    
       <div class="add-item-form" style="margin: 20px 0; padding: 15px; border: 1px solid #ddd;">
        <h3>+ Add New Menu Item</h3>
        <!-- FORM ACTION & ENCTYPE FOR FILE UPLOAD -->
        <form id="addMenuItemForm" action="/add-menu-item" method="POST" enctype="multipart/form-data">
          <div style="margin: 10px 0;">
            <label>Item Name:</label><br>
            <input type="text" name="itemName" placeholder="e.g., Chicken Adobo" required style="width: 250px; padding: 5px;">
          </div>
          <div style="margin: 10px 0;">
            <label>Price (‚Ç±):</label><br>
            <input type="number" name="itemPrice" placeholder="50" min="1" required style="width: 250px; padding: 5px;">
          </div>
          <div style="margin: 10px 0;">
            <label>Category:</label><br>
            <select name="itemCategory" required style="width: 250px; padding: 5px;">
              <option value="Budget Meals">Budget Meals</option>
              <option value="Foods">Foods</option>
              <option value="Drinks">Drinks</option>
            </select>
          </div>
          <div style="margin: 10px 0;">
            <label>Stock Quantity:</label><br>
            <input type="number" name="itemStock" placeholder="49" min="0" required style="width: 250px; padding: 5px;">
          </div>
          <!-- IMAGE UPLOAD FIELD -->
          <div style="margin: 10px 0;">
            <label>Item Image:</label><br>
            <input type="file" name="itemImage" accept="image/jpeg, image/png" style="width: 250px; padding: 5px;">
            <p style="font-size: 12px; color: #666; margin: 5px 0;">Upload JPG/PNG only</p>
          </div>
          <button type="submit" style="background-color: brown; color: white; border: none; padding: 8px 15px;">Add Item</button>
        </form>
      </div>
    
      <!-- ============================================== -->
      <!-- MENU ITEMS LIST (WITH IMAGES) -->
      <!-- ============================================== -->
      <h3>Budget Meals</h3>
      <div id="menuItemsList" style="display: grid; grid-template-columns: repeat(auto-fill, 200px); gap: 15px;">
        <!-- DYNAMIC ITEMS WILL LOAD HERE -->
        <!-- FOR TESTING: STATIC ITEM WITH IMAGE -->
        <div class="menu-item" style="text-align: center; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
          <img src="/static/images/menu_items/default.jpg" alt="Menu Item" style="width: 120px; height: 120px; object-fit: cover; border-radius: 5px;">
          <h4>Sample Item</h4>
          <p>‚Ç±50.00</p>
          <p style="color: green;">50 in stock</p>
          
          <!-- EDIT FORM WITH IMAGE -->
          <form action="/edit-menu-item/1" method="POST" enctype="multipart/form-data" style="margin-top: 10px;">
            <input type="hidden" name="currentImagePath" value="/static/images/menu_items/default.jpg">
            <input type="number" name="editItemStock" value="50" min="0" style="width: 50px; text-align: center;">
            <input type="file" name="editItemImage" accept="image/jpeg, image/png" style="margin: 5px 0; font-size: 12px;">
            <button type="submit" style="margin: 2px; background-color: brown; color: white; border: none; padding: 5px 10px;">Update</button>
            <button type="button" style="margin: 2px; background-color: red; color: white; border: none; padding: 5px 10px;">Delete</button>
          </form>
        </div>
      </div>
    
      <button class="btn-ghost" style="margin-top:20px" onclick="resetAllSoldout()">RESTORE All</button>
    </section>
  </main>

  <script src="/static/script.js"></script>
  <script>
    // --- Tab Switcher ---
    function switchTab(tab) {
      document.getElementById('tabOrders').classList.remove('active');
      document.getElementById('tabMenu').classList.remove('active');
      document.getElementById('ordersSection').classList.remove('active');
      document.getElementById('menuSection').classList.remove('active');

      if (tab === 'orders') {
        document.getElementById('tabOrders').classList.add('active');
        document.getElementById('ordersSection').classList.add('active');
        renderAdminOrders();
      } else {
        document.getElementById('tabMenu').classList.add('active');
        document.getElementById('menuSection').classList.add('active');
        renderAdminMenuList();
      }
    }

    // --- Restore all items ---
    function resetAllSoldOut(){
      if(confirm('Restore all menu items to available?')){
        saveSoldOutItems([]);
        renderAdminMenuList();
        alert('‚úÖ All items are now available!');
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      ensureLoggedIn('admin');
      renderAdminOrders();
    });
  </script>
  <script>
    async function renderAdminMenuList() {
      const response = await fetch('/api/get-menu-items');
      const result = await response.json();
      const list = document.getElementById('menuItemsList');
      
      list.innerHTML = '';
      result.items.forEach(item => {
        list.innerHTML += `
          <div class="menu-item" style="text-align: center; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            <img src="/${item.image_url}" alt="${item.name}" style="width: 120px; height: 120px; object-fit: cover; border-radius: 5px;">
            <h4>${item.name}</h4>
            <p>‚Ç±${item.price}</p>
            <p style="color: ${item.quantity > 0 ? 'green' : 'red'};">${item.quantity} in stock</p>
            
            <form action="/edit-menu-item/${item.id}" method="POST" enctype="multipart/form-data" style="margin-top: 10px;">
              <input type="hidden" name="currentImagePath" value="${item.image_url}">
              <input type="hidden" name="itemName" value="${item.name}">
              <input type="hidden" name="itemPrice" value="${item.price}">
              <input type="hidden" name="itemCategory" value="${item.category}">
              <input type="number" name="editItemStock" value="${item.quantity}" min="0" style="width: 50px; text-align: center;">
              <input type="file" name="editItemImage" accept="image/jpeg, image/png" style="margin: 5px 0; font-size: 12px;">
              <button type="submit" style="margin: 2px; background-color: brown; color: white; border: none; padding: 5px 10px;">Update</button>
              <button type="button" style="margin: 2px; background-color: red; color: white; border: none; padding: 5px 10px;" onclick="deleteMenuItem(${item.id})">Delete</button>
            </form>
          </div>
        `;
      });
    }
  
    // IDAGDAG DIN PARA SA DELETE FUNCTION
    async function deleteMenuItem(itemId) {
      if (confirm('Are you sure you want to delete this item?')) {
        const response = await fetch(`/delete-menu-item/${itemId}`, { method: 'POST' });
        const result = await response.json();
        alert(result.message);
        renderAdminMenuList();
      }
    }
  
    // PAG MAY SWITCH SA MENU TAB, I-LOAD ANG MGA ITEM
    function switchTab(tab) {
      
      if (tab === 'menu') {
        renderAdminMenuList();
      }
    }
  </script>

<script>
  // TAPUSIN ANG SWITCH TAB FUNCTION
  function switchTab(tab) {
    document.getElementById('tabOrders').classList.remove('active');
    document.getElementById('tabMenu').classList.remove('active');
    document.getElementById('ordersSection').classList.remove('active');
    document.getElementById('menuSection').classList.remove('active');
    
    if (tab === 'orders') {
      document.getElementById('tabOrders').classList.add('active');
      document.getElementById('ordersSection').classList.add('active');
    } else {
      document.getElementById('tabMenu').classList.add('active');
      document.getElementById('menuSection').classList.add('active');
      loadMenuItems();
    }
  }

  // ILOAD ANG MGA ITEM NA MAY LARAWAN
  async function loadMenuItems() {
    try {
      const res = await fetch('/api/get-menu-items');
      const data = await res.json();
      const list = document.getElementById('menuItemsList');
      list.innerHTML = '';
      
      data.forEach(item => {
        list.innerHTML += `
          <div class="menu-item">
            <img src="/static/images/menu_items/${item.image_url}" alt="${item.name}" style="width:120px;">
            <h4>${item.name}</h4>
            <p>‚Ç±${item.price}</p>
          </div>
        `;
      });
    } catch (err) {
      console.log('Error:', err);
    }
  }

  // DELETE ITEM
  async function deleteItem(id) {
    await fetch(`/delete-item/${id}`, { method: 'POST' });
    loadMenuItems();
  }

  // RESET ALL ITEMS
  async function resetAllSoldout() {
    await fetch('/reset-all', { method: 'POST' });
    loadMenuItems();
  }
</script>
</body>
</html>
