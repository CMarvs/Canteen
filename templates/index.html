<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>CanteenOS â€” Login</title>
  <link rel="stylesheet" href="/static/style.css">
  <link rel="stylesheet" href="/static/auth.css">
</head>
<body>
  <div class="auth-wrap">
    <div class="auth-card card">
      <h2 class="headline center">ğŸ½ï¸ RMLCanteen â€” Login</h2>

      <label class="input-label">Email</label>
      <input type="email" id="loginEmail" placeholder="you@example.com" required>

      <label class="input-label">Password</label>
      <input type="password" id="loginPass" placeholder="Enter your password" required>

      <button class="btn mt-8" onclick="handleLogin()" id="loginBtn">Login</button>
      
      <div id="loginError" style="display: none; color: #e74c3c; margin-top: 10px; text-align: center; font-size: 0.9rem;"></div>

      <p class="center mt-8 muted">
        Don't have an account? <a href="register.html" class="link">Register</a>
      </p>
    </div>
  </div>

  <script src="/static/script.js"></script>
  <script>
    // if already logged in -> redirect to appropriate page
    (function(){
      const cur = getCurrent();
      if(cur && cur.role === 'admin') location.href='admin.html';
      if(cur && cur.role === 'user') location.href='order.html';
    })();

    function togglePassword(id){
      const el = document.getElementById(id);
      el.type = el.type === 'password' ? 'text' : 'password';
    }

    async function handleLogin(){
      const btn = document.getElementById('loginBtn');
      const errorDiv = document.getElementById('loginError');
      
      // Disable button and show loading
      if(btn) {
        btn.disabled = true;
        btn.textContent = 'Logging in...';
      }
      if(errorDiv) {
        errorDiv.style.display = 'none';
        errorDiv.textContent = '';
      }
      
      try {
        // delegates to script.js login function
        await loginUser();
      } catch(error) {
        console.error('Login handler error:', error);
        if(errorDiv) {
          errorDiv.style.display = 'block';
          errorDiv.textContent = 'Login failed. Please try again.';
        }
      } finally {
        // Re-enable button
        if(btn) {
          btn.disabled = false;
          btn.textContent = 'Login';
        }
      }
    }
    
    // Allow Enter key to submit
    document.addEventListener('DOMContentLoaded', function() {
      const emailInput = document.getElementById('loginEmail');
      const passInput = document.getElementById('loginPass');
      
      if(emailInput && passInput) {
        [emailInput, passInput].forEach(input => {
          input.addEventListener('keypress', function(e) {
            if(e.key === 'Enter') {
              handleLogin();
            }
          });
        });
      }
    });
  </script>
</body>
</html>
